# Data configuration for the listening test

## Preliminaries 

Download and unzip [this file](https://drive.google.com/file/d/1rusPZtXmXwsajHAIXv5QFNpsrPCtcPK_/view?usp=share_link) that contains a `data` folder with the following structure:
```
├── C0
│   ├── 1 (116 files)
│   ├── 2 (87 files)
│   └── 3 (29 files)
├── C1
│   ├── 1 (116 files)
│   ├── 2 (87 files)
│   └── 3 (29 files)
├── C2
│   ├── 1 (116 files)
│   ├── 2 (87 files)
│   └── 3 (29 files)
├── C3
│   ├── 1 (116 files)
│   ├── 2 (87 files)
│   └── 3 (29 files)
└── C4
│   ├── 1 (116 files)
│   ├── 2 (87 files)
│   └── 3 (29 files)
```

Each directory `Cx` corresponds to an experimental condition (let say `C0` corresponds to the unprocessed condition and `C1` to `C4` correspond to the submitted systems). Each experimental condition contains a list of stimuli (with the same `wav` file names) organized into three subfolders (`Cx/1`, `Cx/2`, `Cx/3`) corresponding to the maximum number of simultaneously-active speakers in the stimuli (cf. description of the CHiME-5 data for the UDASE task).

_Remarks_: 

- This `data` folder simulates the data structure for the final listening test. Currently, each condition contains exactly the same files.
- This folder can be created from the CHiME-5 data of the UDASE task using the script `simulate_data.py`.

## Configuration

The configuration of the listening test follows the protocol described in [this Google doc](https://docs.google.com/document/d/1mIRKcIShbw0jMrEd8qqZ5ocXI77wIk8jxgVrCD6P6gk/edit?usp=sharing). For an overall visualization of what should be the output of the listening test, you can also have a look at [this Google spreadsheet](https://docs.google.com/spreadsheets/d/1juJbTaKh-vQbdEh0b_XAWzPmUfX3iVNn-_1vZmJOmz4/edit?usp=sharing), where the green cells are the ones that should be filled by the results of the listening experiments.

The configuration is defined in the `config.csv` and `config.json` files, which were generated by the script `generate_config.py`. To understand the configuration, you can open any of these two files. Each row in the csv file or each entry of the json file corresponds to a stimulus. 

Each stimulus is characterized by the following pieces of information:
- `subset` (an integer between 1 and 4): a subset index, as the entire P.835 test is splitted into 4 subsets (or "sub-tests").
- `session` (an integer between 1 and 4): a listening session index, as each subset is splitted into 4 listening sessions.
- `identifier` (a string): an identifier which is simply the wav file name.
- `num_spk` (an integer between 1 and 3): the number of simultaneously-active speakers.
- `first_scale` (a string which is either `SIG` or `BAK`): the rating scale that will be presented first in the triad.
- `subjects` (list of integers between 1 and 32): the list of subjects who will evaluate the stimulus.

**Important remarks**: 

- We remind that each subject will evaluate all experimental conditions for a given stimulus. This should perhaps be randomized (note that stimuli were randomized when generating the above-described configuration file). 
- For each (stimulus, condition) pair, the same sample (i.e., wav file) will be presented successively three times for evaluation according to three different scales (`SIG`, `BAK`, `OVRL`). The configuration was generated such that for the first two subsets, the first two listening sessions start with the `SIG` scale, while the last two listening sessions start with the `BAK` scale. This order is reversed for the last two subsets.

Below is a high-level view of the repartition of the stimuli (232 files in total) in the different subsets, which allows us to see that the subsets are pretty well balanced.

```
subset: 1
...n_spk: 1
............... 30
...n_spk: 2
............... 22
...n_spk: 3
............... 7
number of stimuli: 59

subset: 2
...n_spk: 1
............... 28
...n_spk: 2
............... 21
...n_spk: 3
............... 8
number of stimuli: 57

subset: 3
...n_spk: 1
............... 29
...n_spk: 2
............... 22
...n_spk: 3
............... 7
number of stimuli: 58

subset: 4
...n_spk: 1
............... 29
...n_spk: 2
............... 22
...n_spk: 3
............... 7
number of stimuli: 58
```